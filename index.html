<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Cycle Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .transition-width { transition: width 1s linear; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col items-center justify-center p-4 overflow-hidden">

    <!-- Main Card -->
    <div class="bg-white w-full max-w-md rounded-2xl shadow-lg border border-slate-100 overflow-hidden relative">
        
        <!-- Header / Status -->
        <div id="header-bg" class="bg-indigo-600 p-6 text-white text-center transition-colors duration-500">
            <h2 id="stage-name" class="text-xl font-semibold tracking-wide uppercase opacity-90">Ready to Learn</h2>
            <p id="stage-desc" class="text-xs text-indigo-100 mt-1 opacity-80">Press start to begin cycle</p>
        </div>

        <!-- Timer Display -->
        <div class="p-8 flex flex-col items-center justify-center">
            <div class="text-7xl font-bold text-slate-700 tracking-tighter mb-2 font-mono" id="timer-display">25:00</div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-slate-100 rounded-full h-2.5 mb-6 overflow-hidden">
                <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full transition-width" style="width: 100%"></div>
            </div>

            <!-- Controls -->
            <div class="flex gap-4">
                <button onclick="toggleTimer()" id="start-btn" class="flex items-center gap-2 px-6 py-2 bg-slate-900 text-white rounded-lg hover:bg-slate-700 transition active:scale-95 shadow-md">
                    <i class="fas fa-play" id="play-icon"></i> <span id="btn-text">Start</span>
                </button>
                <button onclick="nextStage()" class="flex items-center justify-center w-10 h-10 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition" title="Skip Stage">
                    <i class="fas fa-step-forward"></i>
                </button>
                <button onclick="resetTimer()" class="flex items-center justify-center w-10 h-10 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-full transition" title="Reset Cycle">
                    <i class="fas fa-redo-alt"></i>
                </button>
            </div>
        </div>

        <!-- Stage Indicators -->
        <div class="bg-slate-50 px-6 py-4 border-t border-slate-100 flex justify-between items-center text-xs text-slate-400">
            <div id="dot-1" class="flex flex-col items-center gap-1 opacity-50 transition-opacity">
                <div class="w-3 h-3 rounded-full bg-indigo-500"></div>
                <span>Focus</span>
            </div>
            <div class="w-8 h-px bg-slate-200"></div>
            <div id="dot-2" class="flex flex-col items-center gap-1 opacity-50 transition-opacity">
                <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                <span>Retrieve</span>
            </div>
            <div class="w-8 h-px bg-slate-200"></div>
            <div id="dot-3" class="flex flex-col items-center gap-1 opacity-50 transition-opacity">
                <div class="w-3 h-3 rounded-full bg-violet-500"></div>
                <span>Rest</span>
            </div>
        </div>
    </div>

    <!-- Instructions for Notion Users -->
    <div class="mt-4 text-slate-400 text-xs text-center">
        <p>Embed this in Notion using <code class="bg-slate-200 px-1 rounded">/embed</code></p>
    </div>

    <!-- Hidden Audio Elements -->
    <!-- Using short beep frequencies generated by JS AudioContext would be better, but for simplicity/reliability in iframes we use simple logic below -->

    <script>
        // Configuration
        const STAGES = [
            {
                name: "Deep Focus",
                desc: "Eliminate distractions. Single task only.",
                duration: 25 * 60, // 25 mins
                color: "bg-indigo-600",
                barColor: "bg-indigo-600",
                dotId: "dot-1"
            },
            {
                name: "Active Recall",
                desc: "Write down everything you remember.",
                duration: 5 * 60, // 5 mins
                color: "bg-emerald-600",
                barColor: "bg-emerald-600",
                dotId: "dot-2"
            },
            {
                name: "Restful Wakefulness",
                desc: "Close eyes. Do nothing. Let brain consolidate.",
                duration: 3 * 60, // 3 mins
                color: "bg-violet-600",
                barColor: "bg-violet-600",
                dotId: "dot-3"
            }
        ];

        let currentStageIndex = 0;
        let timeLeft = STAGES[0].duration;
        let isRunning = false;
        let interval;
        let totalTime = STAGES[0].duration;

        // DOM Elements
        const timerDisplay = document.getElementById('timer-display');
        const stageName = document.getElementById('stage-name');
        const stageDesc = document.getElementById('stage-desc');
        const progressBar = document.getElementById('progress-bar');
        const headerBg = document.getElementById('header-bg');
        const startBtn = document.getElementById('start-btn');
        const playIcon = document.getElementById('play-icon');
        const btnText = document.getElementById('btn-text');

        // Audio Context for beeps
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playNotification() {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function updateUI() {
            const stage = STAGES[currentStageIndex];
            
            // Text
            timerDisplay.textContent = formatTime(timeLeft);
            stageName.textContent = stage.name;
            stageDesc.textContent = stage.desc;
            
            // Colors
            headerBg.className = `${stage.color} p-6 text-white text-center transition-colors duration-500`;
            progressBar.className = `${stage.barColor} h-2.5 rounded-full transition-all duration-1000`;
            
            // Progress Calculation
            const percentage = (timeLeft / totalTime) * 100;
            progressBar.style.width = `${percentage}%`;

            // Active Dot
            [1, 2, 3].forEach(i => {
                const dot = document.getElementById(`dot-${i}`);
                if (`dot-${i}` === stage.dotId) {
                    dot.classList.remove('opacity-50');
                    dot.classList.add('opacity-100', 'font-bold');
                } else {
                    dot.classList.add('opacity-50');
                    dot.classList.remove('opacity-100', 'font-bold');
                }
            });
        }

        function completeCycle() {
            clearInterval(interval);
            isRunning = false;
            updateBtnState();
            playNotification();
            
            // Reset to beginning
            currentStageIndex = 0;
            totalTime = STAGES[0].duration;
            timeLeft = totalTime;
            
            stageName.textContent = "Cycle Complete";
            stageDesc.textContent = "Great work! Take a long break or restart.";
            headerBg.className = "bg-slate-800 p-6 text-white text-center transition-colors duration-500";
            progressBar.style.width = "100%";
        }

        function nextStage() {
            playNotification();
            currentStageIndex++;
            
            if (currentStageIndex >= STAGES.length) {
                completeCycle();
                return;
            }

            // Setup next stage
            const stage = STAGES[currentStageIndex];
            timeLeft = stage.duration;
            totalTime = stage.duration;
            updateUI();
        }

        function toggleTimer() {
            if (isRunning) {
                clearInterval(interval);
                isRunning = false;
            } else {
                // Resume audio context on user gesture
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }

                isRunning = true;
                interval = setInterval(() => {
                    timeLeft--;
                    updateUI();
                    
                    if (timeLeft <= 0) {
                        nextStage();
                    }
                }, 1000);
            }
            updateBtnState();
        }

        function updateBtnState() {
            if (isRunning) {
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
                btnText.textContent = "Pause";
            } else {
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
                btnText.textContent = "Start";
            }
        }

        function resetTimer() {
            clearInterval(interval);
            isRunning = false;
            currentStageIndex = 0;
            const stage = STAGES[0];
            timeLeft = stage.duration;
            totalTime = stage.duration;
            updateUI();
            updateBtnState();
        }

        // Initialize
        updateUI();

    </script>
</body>
</html>